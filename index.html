<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Stlink-trace : ST-Link V2 ITM trace utility" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Stlink-trace</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/obe1line/stlink-trace">View on GitHub</a>

          <h1 id="project_title">Stlink-trace</h1>
          <h2 id="project_tagline">ST-Link V2 ITM trace utility</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/obe1line/stlink-trace/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/obe1line/stlink-trace/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>Introduction</h3>

<p>Stlink-trace is a utility to log ITM printf traces from an ST-Link V2 JTAG adapter. It fetches data transmitted from the ITM stimulus port 0 of the STM32Fxxx series microcontrollers.</p>

<h3>Building the utility</h3>

<p>Libusbx is used to communicate with the ST-Link, so this is a pre-requisite.</p>
<p>The source contains an Eclipse project which can be imported. Alternatively use the following command line to build it:</p>

<pre><code>$ gcc stlink-trace.c -lusb-1.0 -L/usr/local/lib -o stlink-trace
</code></pre>

<p>A source file showing the triggering of the ITM port is included in the Examples folder. A Waveshare Open107Z development board was used to run this, but an existing project can be modified by using the SendMsgViaITM function.
Although the ITM supports 1,2 or 4 bytes trace data, a change to the utility would be required to support anything other than the 1 byte trace.
</p>

<h3>Running it</h3>

<p>By default, the microcontroller is expected to be an STM32F107 running at 72MHz. For other versions, you may need to change the stlink-trace source to use the correct CLOCK_DIVISOR. E.g. STM32F207Z runs at 120MHz.</p>
<p>Running the utility will generate two files: trace and full-trace. The difference is that the full-trace includes error packets that were received (handling this packet is on the TODO list and relates to a trace packet length of 0xF8xx).</p>

<h3>Support</h3>

<p>If the wiki doesn't cover any questions you may have, email me at: obe1line AT trisync.net.au</p>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Stlink-trace maintained by <a href="https://github.com/obe1line">obe1line</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

  </body>
</html>
